<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name='viewport' content='width=device-width,initial-scale=1,user-scalable=no' />
		<title>音悦台</title>
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
	</head>
	<body>
		<div id="wrap">
			<header class="header">
				<div class="headerTop">
					<h1 class="logo">
						<a href="javascript:;">
							<img src="img/logo.png" alt="">
						</a>
					</h1>
					<a href="javascript:;" class="menuBtn menuClose"></a>
					<div class="btns">
						<a href="javascript:;">搜索</a>
						<a href="javascript:;">登录</a>
						<a href="javascript:;">注册</a>
					</div>
				</div>
				<form action="" class="search">
					<input type="text" placeholder='请输入搜索内容。。。'>
					<input type="submit" value='搜索'>
				</form>
				<ul class="mask">
					<li><a href="javascript:;">首页</a></li>
					<li><a href="javascript:;">MV</a></li>
					<li><a href="javascript:;">悦单</a></li>
					<li><a href="javascript:;">V榜</a></li>
					<li><a href="javascript:;">音悦</a></li>
					<li><a href="javascript:;">商城</a></li>
					<li><a href="javascript:;">节目</a></li>
					<li><a href="javascript:;">饭团</a></li>
					<li><a href="javascript:;">资讯</a></li>
					<li><a href="javascript:;">我的家</a></li>
					<li><a href="javascript:;">APP下载</a></li>
					<li><a href="javascript:;">热门应用</a></li>
				</ul>
			</header>
			<div class="contentWrap">
				<div class="content">
					<nav class="navWrap">
						<ul class="navList">
							<li class="active"><a href="javascript:;">首页</a></li>
							<li><a href="javascript:;">MV</a></li>
							<li><a href="javascript:;">悦单</a></li>
							<li><a href="javascript:;">V榜</a></li>
							<li><a href="javascript:;">音悦</a></li>
							<li><a href="javascript:;">商城</a></li>
							<li><a href="javascript:;">节目</a></li>
							<li><a href="javascript:;">饭团</a></li>
							<li><a href="javascript:;">资讯</a></li>
							<li><a href="javascript:;">我的家</a></li>
							<li><a href="javascript:;">APP下载</a></li>
							<li><a href="javascript:;">热门应用</a></li>
						</ul>
					</nav>
					<div class="bannerWrap">
						<ul class="bannerList">
							<li>
								<a href="javascript:;">
									<img src="img/1.jpg" alt="" />
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<img src="img/2.jpg" alt="" />
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<img src="img/3.jpg" alt="" />
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<img src="img/4.jpg" alt="" />
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<img src="img/5.jpg" alt="" />
								</a>
							</li>
						</ul>
						<div class="icons">
							<span class='active'></span>
							<span></span>
							<span></span>
							<span></span>
							<span></span>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script src="js/transform.js"></script>
		<script type="text/javascript">
			!(function(){
				var width=document.documentElement.clientWidth;
				var styleNode=document.createElement('style');
				styleNode.innerHTML='html{font-size:'+width/16+'px !important;}';
				document.head.appendChild(styleNode);
			})();
			document.addEventListener('touchstart',function(e){
				e.preventDefault();
			});
			var aNodes=document.querySelectorAll('a');
			for (var i = 0; i < aNodes.length; i++) {
				aNodes[i].addEventListener('touchstart',function(){
					window.location.href=this.href;
				});
			}
			
			//头部菜单效果
			menuBtnChange();
			function menuBtnChange(){
				var menuBtn=document.querySelector('#wrap .header .headerTop .menuBtn');
				var mask=document.querySelector('#wrap .header .mask');
				var flag=false;
				menuBtn.addEventListener('touchstart',function(e){
					if(flag){
						menuBtn.className='menuBtn menuClose';
						mask.style.display='none';
					}else{
						menuBtn.className='menuBtn menuOpen';
						mask.style.display='block';
					}
					flag=!flag;
					e.stopPropagation();
					e.preventDefault();
				});
				document.addEventListener('touchstart',function(){
					if(flag){
						menuBtn.className='menuBtn menuClose';
						mask.style.display='none';
					}
					flag=false;
				});
				mask.addEventListener('touchstart',function(e){
					e.stopPropagation();
					e.preventDefault();
				});
			}
			//搜索框焦点获取
			focusChange();
			function focusChange(){
				var textInput=document.querySelector('#wrap .header .search input[type="text"]');
				textInput.addEventListener('touchstart',function(e){
					textInput.focus();
					e.stopPropagation();
					e.preventDefault();
				});
				document.addEventListener('touchstart',function(){
					textInput.blur();
				});
			}
			
			//导航滑动
			navMove();
			function navMove(){
				var navWrap=document.querySelector('#wrap .contentWrap .content .navWrap');
				var navList=document.querySelector('#wrap .contentWrap .content .navWrap .navList');
				var eleX=0;
				var startX=0;
				var s1=0;
				var t1=0;
				var s2=0;
				var t2=0;
				navWrap.addEventListener('touchstart',function(e){
					var touch=e.changedTouches[0];
					navList.style.transition='none';
					eleX=transformCss(navList,'translateX');
					startX=touch.clientX;
					s1=eleX;
					t1=new Date().getTime();
				});
				navWrap.addEventListener('touchmove',function(e){
					var touch=e.changedTouches[0];
					var endX=touch.clientX;
					var disX=endX-startX;
					var lastX=eleX+disX;
					if(lastX>0){
						var scale=0.6-lastX/(3*document.documentElement.clientWidth);
						lastX=lastX*scale;
					}else if(lastX<document.documentElement.clientWidth-navList.offsetWidth){
						var temp=Math.abs(lastX)-Math.abs(document.documentElement.clientWidth-navList.offsetWidth);
						var scale=0.6-temp/(3*document.documentElement.clientWidth);
						temp=temp*scale;
						lastX=document.documentElement.clientWidth-navList.offsetWidth-temp;
					}
					transformCss(navList,'translateX',lastX);
				});
				navWrap.addEventListener('touchend',function(e){
					var touch=e.changedTouches[0];
					//加速
					s2=transformCss(navList,'translateX');
					t2=new Date().getTime();
					var speed=(s2-s1)/(t2-t1);
					var lastX=s2+speed*100;
					//回退
					var bezier='';
					if(lastX>0){
						lastX=0;
						bezier='cubic-bezier(.13,.67,.67,1.73)';
					}else if(lastX<document.documentElement.clientWidth-navList.offsetWidth){
						lastX=document.documentElement.clientWidth-navList.offsetWidth;
						bezier='cubic-bezier(.13,.67,.67,1.73)';
					}
					navList.style.transition='1s '+bezier;
					transformCss(navList,'translateX',lastX);
				});
			}
			//改变导航颜色
			navChangeColor();
			function navChangeColor(){
				var navItems=document.querySelectorAll('#wrap .contentWrap .content .navWrap .navList li');
				var isMove=false;
				for (var i = 0; i < navItems.length; i++) {
					//解决误触
					navItems[i].addEventListener('touchmove',function(){
						isMove=true;
					})
					navItems[i].addEventListener('touchend',function(){
						if(!isMove){
							for (var j = 0; j< navItems.length; j++) {
								navItems[j].className='';
							}
							this.className='active';
						}
						isMove=false;
					});
				}
			}
			
			//banner
			
			var bannerWrap=document.querySelector('#wrap .contentWrap .content .bannerWrap');
			var bannerList=document.querySelector('#wrap .contentWrap .content .bannerWrap .bannerList');
			bannerList.innerHTML+=bannerList.innerHTML;
			var bannerItems=document.querySelectorAll('#wrap .contentWrap .content .bannerWrap .bannerList li');
			var styleNode=document.createElement('style');
			styleNode.innerHTML='#wrap .contentWrap .content .bannerWrap .bannerList{width: '+bannerItems.length+'00%;}';
			styleNode.innerHTML+='#wrap .contentWrap .content .bannerWrap .bannerList li{width:'+100/bannerItems.length+'%;}';
			document.head.appendChild(styleNode);
			var iconItems=document.querySelectorAll('#wrap .contentWrap .content .bannerWrap .icons span');
			var eleX=0;
			var startX=0;
			var index=0;
			var timer=0;
			bannerWrap.addEventListener('touchstart',function(e){
				var touch=e.changedTouches[0];
				clearInterval(timer);
				bannerList.style.transition='none';
				if(index==0){
					index=iconItems.length;
					var lastX=-index*document.documentElement.clientWidth;
					transformCss(bannerList,'translateX',lastX);
				}else if(index==bannerItems.length-1){
					index=iconItems.length-1;
					var lastX=-index*document.documentElement.clientWidth;
					transformCss(bannerList,'translateX',lastX);
				}
				eleX=transformCss(bannerList,'translateX');
				startX=touch.clientX;
			});
			bannerWrap.addEventListener('touchmove',function(e){
				var touch=e.changedTouches[0];
				var endX=touch.clientX;
				var disX=endX-startX;
				var lastX=eleX+disX;
				
				transformCss(bannerList,'translateX',lastX);
			});
			bannerWrap.addEventListener('touchend',function(e){
				var touch=e.changedTouches[0];
				var endX=transformCss(bannerList,'translateX');
				index=Math.round(-endX/document.documentElement.clientWidth);
				var lastX=-index*document.documentElement.clientWidth;
				bannerList.style.transition='1s';
				transformCss(bannerList,'translateX',lastX);
				for (var i = 0; i < iconItems.length; i++) {
					iconItems[i].className='';
				}
				iconItems[index%iconItems.length].className='active';
				autoMove();
			});
			
			function autoMove(){
				timer=setInterval(function(){
					if(index==bannerItems.length-1){
						index=iconItems.length-1;
						var lastX=-index*document.documentElement.clientWidth;
						bannerList.style.transition='none';
						transformCss(bannerList,'translateX',lastX);
					}
					
					setTimeout(function(){
						index++;
						var lastX=-index*document.documentElement.clientWidth;
						bannerList.style.transition='1s';
						transformCss(bannerList,'translateX',lastX);
						for (var i = 0; i < iconItems.length; i++) {
							iconItems[i].className='';
						}
						iconItems[index%iconItems.length].className='active';
					},20);
				},2000);
			}
			
			
		</script>
	</body>
</html>
